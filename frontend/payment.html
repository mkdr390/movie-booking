<html>
<head>
<body>
<link rel="stylesheet" href="/styles/main.css">
<div class="left">
<h3>Sky Movies</h3></div>
<div>
<a href="/">Home</a>
 </div>
<form id="payment-form" method="post">
  <h2>Payment</h2>
  <label for="viewername">Viewer Name:</label>
  <input type="text" id="viewername" name="viewerName"><br><br>
 <label for="date">Date:</label>
<input type="date" id="date" name="date"><br>
  <label for="cardnumber">Card Number:</label>
  <input type="text" id="cardnumber" name="cardNumber"><br><br>
  <label for="expirydate">Expiry Date:</label>
  <input type="text" id="expirydate" name="expiryDate"><br><br>
  <label for="cvv">CVV:</label>
  <input type="text" id="cvv" name="cvv"><br><br>
  <center><button header class="header1" onclick="return payment()" class="logo1" >
    Pay now
</button> 
</header>    
</form>
<script>
  function payment() {
    
      const paymentForm = document.getElementById("payment-form");
      const isValid = paymentForm.checkValidity();

      if (isValid) {

        const formData = new FormData(paymentForm);

        const formDataObj = {};

        formData.forEach((value, key) => {
          formDataObj[key] = value;
        })

        console.log(JSON.stringify(formDataObj))
        
        fetch('http://localhost:3000/payment',{
        
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(formDataObj)
        }).then((response) => {
          if (response.ok) {
            return response.json();
          }
          throw new Error('Something went wrong');
        }).then((res) => {
          if (res.status === 1) {
            window.location = "/PaymentViewPage.html"
          } else {
            alert("Error response")
          }
        }).catch(() => {
          alert("Error creating the user");
        });
      } else {
        console.log("no")
      }


      return false;
    }
    
  </script>
</body>
</head>
</html>